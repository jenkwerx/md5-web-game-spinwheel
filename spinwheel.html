<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD5 Spin Wheel</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .salt-section {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        .audit-section {
            text-align: center;
            margin-top: 15px;
        }

        .salt-section h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        #saltDisplay {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            color: #007bff;
            background: white;
            padding: 10px;
            border-radius: 5px;
            display: inline-block;
            border: 1px solid #ddd;
        }

        .text-section {
            display: flex;
            flex-direction: column;
        }

        .text-section h3 {
            margin-bottom: 10px;
            color: #555;
        }

        #entriesText {
            width: 100%;
            height: 300px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
            resize: vertical;
            box-sizing: border-box;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        /* Hide button when spinning */
        .btn-danger.spinning {
            display: none;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .wheel-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .wheel-container {
            position: relative;
            margin-bottom: 20px;
        }

        #wheelCanvas {
            border: 5px solid #333;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #333, #666);
            border-radius: 50%;
            border: 3px solid #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #ff4444;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            z-index: 10;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .winner-text {
            font-size: 2em;
            color: #333;
            margin-bottom: 20px;
        }

        .winner-name {
            font-size: 2.5em;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .checkbox-container {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .fireworks {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: explode 1s ease-out;
        }

        /* Jackpot Slot Machine Styles */
        .jackpot-section {
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 15px;
            border: 3px solid #B8860B;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .jackpot-title {
            font-size: 1.8em;
            color: #8B4513;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        .slot-machine {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .slot-reel {
            width: 80px;
            height: 100px;
            background: linear-gradient(180deg, #2C2C2C, #1C1C1C);
            border: 4px solid #444;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .slot-letter {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            font-family: 'Courier New', monospace;
            border: 3px solid #fff;
            border-radius: 8px;
            padding: 5px 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* Letter colors with contrasting backgrounds */
        .slot-letter.letter-A { 
            color: #FFD700; 
            background: linear-gradient(145deg, #6637, #331);
        } /* Yellow on dark */
        .slot-letter.letter-B { 
            color: #d27Bd2; 
            background: linear-gradient(145deg, #402050, #200010);
        } /* Purple on light */
        .slot-letter.letter-C { 
            color: #CC5500; 
            background: linear-gradient(145deg, #ffdd030, #996600);
        } /* Burnt Orange on light */
        .slot-letter.letter-D { 
            color: #000066; 
            background: linear-gradient(145deg, #ccccff, #9999cc);
        } /* Dark Blue on light */
        .slot-letter.letter-E { 
            color: #660000; 
            background: linear-gradient(145deg, #f0d0d0, #a0b0b0);
        } /* Maroon on light */
        .slot-letter.letter-F { 
            color: #006400; 
            background: linear-gradient(145deg, #99ff99, #77dd77);
        } /* Dark Green on light */
        .slot-letter.letter-G { 
            color: #333333; 
            background: linear-gradient(145deg, #ffffff, #cccccc);
        } /* Grey on light */

        .slot-reel.spinning .slot-letter {
            animation: slotSpin 2s ease-out;
            opacity: 0; /* Hide letters during spin */
            visibility: hidden; /* Extra hiding to prevent any flashing */
        }

        .jackpot-result {
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .jackpot-win {
            background: linear-gradient(45deg, #32CD32, #228B22);
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .jackpot-lose {
            background: linear-gradient(45deg, #DC143C, #B22222);
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .jackpot-empty {
            background: linear-gradient(45deg, #DC14DC, #822282);
            color: yellow;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        /* Hide elements during spin */
        .hidden-during-spin {
            transition: opacity 0.3s ease;
        }

        .hidden-during-spin.hide {
            opacity: 0;
            pointer-events: none;
        }

        /* Hide elements during jackpot */
        .hidden-during-jackpot {
            transition: opacity 0.3s ease;
        }

        .hidden-during-jackpot.hide {
            opacity: 0;
            pointer-events: none;
        }

        /* Expand wheel section when elements are hidden */
        .wheel-section {
            transition: all 0.3s ease;
        }

        .wheel-section.expanded {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
        }

        .wheel-section.expanded .wheel-container {
            margin-bottom: 40px;
        }

        .wheel-section.expanded #wheelCanvas {
            width: min(70vh, 70vw);
            height: min(70vh, 70vw);
            max-width: 500px;
            max-height: 500px;
        }

        .wheel-section.expanded button {
            padding: 20px 40px;
            font-size: 1.4em;
            min-width: 250px;
        }

        /* Override expanded button style when spinning */
        .wheel-section.expanded button.spinning {
            padding: 10px 20px;
            font-size: 14px;
            min-width: 100px;
        }

        @keyframes explode {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            50% {
                transform: scale(1);
                opacity: 0.8;
            }
            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slotSpin {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-200px); }
            100% { transform: translateY(0px); }
        }

        .spinning {
            animation: spin 4s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
                margin: 0;
                border-radius: 10px;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 20px;
            }

            .controls {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }

            .salt-section {
                padding: 10px;
                margin-bottom: 15px;
            }

            #saltDisplay {
                font-size: 14px;
                padding: 8px;
            }

            #entriesText {
                height: 200px;
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            .button-group {
                flex-direction: column;
                gap: 8px;
            }
            
            button {
                min-width: auto;
                padding: 14px 16px;
                font-size: 14px;
            }

            .btn-danger.spinning {
                display: none;
            }

            #wheelCanvas {
                width: 280px !important;
                height: 280px !important;
                border-width: 3px;
            }

            .wheel-container {
                margin-bottom: 15px;
            }

            .pointer {
                border-left-width: 15px;
                border-right-width: 15px;
                border-top-width: 25px;
            }

            .wheel-center {
                width: 30px;
                height: 30px;
            }

            /* Mobile-specific expanded state */
            .wheel-section.expanded {
                padding: 20px;
            }

            .wheel-section.expanded #wheelCanvas {
                width: min(60vh, 80vw);
                height: min(60vh, 80vw);
                max-width: 350px;
                max-height: 350px;
            }

            .wheel-section.expanded button {
                padding: 18px 32px;
                font-size: 1.2em;
                min-width: 200px;
            }

            .wheel-section.expanded button.spinning {
                display: none;
            }

            /* Modal improvements for mobile */
            .modal-content {
                margin: 20px;
                padding: 20px;
                max-width: calc(100vw - 40px);
                max-height: calc(100vh - 40px);
                overflow-y: auto;
            }

            .winner-text {
                font-size: 1.5em;
            }

            .winner-name {
                font-size: 2em;
                margin: 15px 0;
            }

            /* Mobile jackpot styles */
            .jackpot-title {
                font-size: 1.4em;
            }

            .slot-machine {
                gap: 10px;
            }

            .slot-reel {
                width: 60px;
                height: 80px;
            }

            .slot-letter {
                font-size: 2.2em;
            }

            .jackpot-result {
                font-size: 1.1em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }

            #wheelCanvas {
                width: 250px !important;
                height: 250px !important;
            }

            .wheel-section.expanded #wheelCanvas {
                width: min(50vh, 70vw);
                height: min(50vh, 70vw);
                max-width: 280px;
                max-height: 280px;
            }

            .modal-content {
                margin: 10px;
                padding: 15px;
            }

            .winner-name {
                font-size: 1.8em;
            }

            .slot-reel {
                width: 50px;
                height: 70px;
            }

            .slot-letter {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>

    <div class="container">

        
        <div class="controls">
            <div class="text-section hidden-during-spin hidden-during-jackpot">
                <h3>Enter Items (one per line):</h3>
                <textarea id="entriesText" placeholder="Apple&#10;Banana&#10;Orange&#10;Grape&#10;Strawberry&#10;Pineapple"></textarea>
                <div class="button-group">
                    <button class="btn-primary" onclick="removeDuplicates()">Remove Duplicates</button>
                    <button class="btn-secondary" onclick="sortEntries()">Sort A-Z</button>
                    <button class="btn-warning" onclick="randomizeEntries()">Randomize</button>
                </div>
            </div>
            
            <div class="wheel-section">
                <div class="wheel-container">
                    <div class="pointer"></div>
                    <canvas id="wheelCanvas" width="350" height="350"></canvas>
                    <div class="wheel-center"></div>
                </div>
                <button class="btn-danger" onclick="spinWheel()" id="spinBtn">ðŸŽ° SPIN THE WHEEL! ðŸŽ°</button>
            </div>
        </div>
        
        <div class="salt-section hidden-during-spin hidden-during-jackpot">
            <h3>Salt (Timestamp):</h3>
            <div id="saltDisplay"></div>
        </div>

        <div class="audit-section hidden-during-spin hidden-during-jackpot">
            <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; font-family: monospace; font-size: 12px; text-align: left; border: 2px solid #e9ecef;">
                <div style="margin-bottom: 8px; text-align: center;"><strong>Current Audit Information:</strong></div>
                <div style="margin-bottom: 4px;"><strong>MD5 Hash:</strong> <span id="currentHash">-</span></div>
                <div style="margin-bottom: 4px;"><strong>Combined Value:</strong> <span id="currentCombined">-</span></div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn-secondary" onclick="window.open('https://www.md5hashgenerator.com/', '_blank')">Test MD5 Hash</button>
                </div>

        <h1 class="hidden-during-spin hidden-during-jackpot">ðŸ”’ MD5 Spin Wheel ðŸ”’</h1>
            </div>
        </div>
    </div>

    <div id="winnerModal" class="modal">
        <div class="modal-content">
            <div class="fireworks" id="fireworks"></div>
            <div class="winner-text">ðŸŽ‰ Congratulations! ðŸŽ‰</div>
            <div class="winner-name" id="winnerName"></div>
            
            <!-- Jackpot Slot Machine Section -->
            <div class="jackpot-section" id="jackpotSection">
                <div class="jackpot-title">ðŸŽ° BONUS JACKPOT ðŸŽ°</div>
                <div class="slot-machine">
                    <div class="slot-reel" id="reel1">
                        <div class="slot-letter letter-A" id="letter1">A</div>
                    </div>
                    <div class="slot-reel" id="reel2">
                        <div class="slot-letter letter-A" id="letter2">A</div>
                    </div>
                    <div class="slot-reel" id="reel3">
                        <div class="slot-letter letter-A" id="letter3">A</div>
                    </div>
                </div>
                <div class="jackpot-result hidden-during-jackpot" id="jackpotResult"></div>
            </div>
            
            <div style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; font-family: monospace; font-size: 12px; text-align: left;" class="hidden-during-jackpot">
                <div style="margin-bottom: 8px;"><strong>Audit Information:</strong></div>
                <div style="margin-bottom: 4px;"><strong>MD5 Hash:</strong> <span id="winnerHash"></span></div>
                <div style="margin-bottom: 4px;"><strong>Combined Value:</strong> <span id="winnerCombined"></span></div>
            </div>
            
            <div class="checkbox-container hidden-during-jackpot">
                <input type="checkbox" id="removeWinner">
                <label for="removeWinner">Remove winner from wheel</label>
            </div>
            <button class="btn-primary hidden-during-jackpot" onclick="closeWinnerModal()">Close & Spin Again!</button>
        </div>
		<div style='visibility:hidden;' id='divspin'>0</div>

    </div>

    <script>
        let entries = ['Apple', 'Banana', 'Orange', 'Grape', 'Strawberry', 'Pineapple'];
        let removedEntries = new Set(); // Track removed entries
        let isSpinning = false;
        let isJackpotRunning = false; // Track jackpot state
        let currentRotation = 0;
        let currentSalt = '';

        const colors = [
            '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', 
            '#00FFFF', '#FF8000', '#8000FF', '#00FF80', '#FF0080',
            '#80FF00', '#0080FF', '#FF4000', '#4000FF', '#00FF40'
        ];

        function updateCurrentAuditInfo() {
            const activeEntries = getActiveEntries();
            if (activeEntries.length === 0) {
                document.getElementById('currentHash').textContent = '-';
                document.getElementById('currentCombined').textContent = '-';
                return;
            }

            // Find what would be the current winner
            const winnerData = findWinnerByMD5();
            if (winnerData) {
                document.getElementById('currentHash').textContent = winnerData.hash;
                document.getElementById('currentCombined').textContent = winnerData.combined;
            }
        }

        // Function to determine if text should be white or black based on background color
        function getTextColor(bgColor) {
            // Convert hex to RGB
            const hex = bgColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            // Calculate luminance
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            // Return white for dark colors, black for light colors
            return luminance > 0.5 ? '#000000' : '#ffffff';
        }

        // Function to hide elements during spin
        function hideElementsDuringSpin() {
            const elementsToHide = document.querySelectorAll('.hidden-during-spin');
            elementsToHide.forEach(element => {
                element.classList.add('hide');
            });
            
            // Expand the wheel section
            const wheelSection = document.querySelector('.wheel-section');
            wheelSection.classList.add('expanded');
        }

        // Function to show elements after spin
        function showElementsAfterSpin() {
            const elementsToHide = document.querySelectorAll('.hidden-during-spin');
            elementsToHide.forEach(element => {
                element.classList.remove('hide');
            });
            
            // Collapse the wheel section back to normal
            const wheelSection = document.querySelector('.wheel-section');
            wheelSection.classList.remove('expanded');
        }

        // Function to hide elements during jackpot
        function hideElementsDuringJackpot() {
            const elementsToHide = document.querySelectorAll('.hidden-during-jackpot');
            elementsToHide.forEach(element => {
                element.classList.add('hide');
            });
        }

        // Function to show elements after jackpot
        function showElementsAfterJackpot() {
            const elementsToHide = document.querySelectorAll('.hidden-during-jackpot');
            elementsToHide.forEach(element => {
                element.classList.remove('hide');
            });
        }

        // Correct MD5 implementation
        function md5(str) {
            // Convert string to UTF-8 bytes
            const utf8Encode = (str) => {
                return unescape(encodeURIComponent(str));
            };
            
            str = utf8Encode(str);
            
            const rotateLeft = (value, shift) => {
                return (value << shift) | (value >>> (32 - shift));
            };
            
            const addUnsigned = (x, y) => {
                const lsw = (x & 0xFFFF) + (y & 0xFFFF);
                const msw = (x >> 16) + (y >> 16) + (lsw >> 16);
                return (msw << 16) | (lsw & 0xFFFF);
            };
            
            const f = (x, y, z) => (x & y) | (~x & z);
            const g = (x, y, z) => (x & z) | (y & ~z);
            const h = (x, y, z) => x ^ y ^ z;
            const i = (x, y, z) => y ^ (x | ~z);
            
            const ff = (a, b, c, d, x, s, ac) => {
                a = addUnsigned(a, addUnsigned(addUnsigned(f(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            };
            
            const gg = (a, b, c, d, x, s, ac) => {
                a = addUnsigned(a, addUnsigned(addUnsigned(g(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            };
            
            const hh = (a, b, c, d, x, s, ac) => {
                a = addUnsigned(a, addUnsigned(addUnsigned(h(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            };
            
            const ii = (a, b, c, d, x, s, ac) => {
                a = addUnsigned(a, addUnsigned(addUnsigned(i(b, c, d), x), ac));
                return addUnsigned(rotateLeft(a, s), b);
            };
            
            const convertToWordArray = (str) => {
                let wordArray = [];
                const wordCount = (((str.length + 8) >>> 6) + 1) * 16;
                
                for (let i = 0; i < wordCount; i++) {
                    wordArray[i] = 0;
                }
                
                for (let i = 0; i < str.length; i++) {
                    wordArray[i >>> 2] |= (str.charCodeAt(i) & 0xFF) << ((i % 4) * 8);
                }
                
                wordArray[str.length >>> 2] |= 0x80 << ((str.length % 4) * 8);
                wordArray[wordCount - 2] = str.length * 8;
                
                return wordArray;
            };
            
            const wordToHex = (value) => {
                let hex = '';
                for (let i = 0; i <= 3; i++) {
                    const byte = (value >>> (i * 8)) & 255;
                    hex += ('0' + byte.toString(16)).substr(-2);
                }
                return hex;
            };
            
            const x = convertToWordArray(str);
            let a = 0x67452301;
            let b = 0xEFCDAB89;
            let c = 0x98BADCFE;
            let d = 0x10325476;
            
            for (let k = 0; k < x.length; k += 16) {
                const AA = a, BB = b, CC = c, DD = d;
                
                a = ff(a, b, c, d, x[k], 7, 0xD76AA478);
                d = ff(d, a, b, c, x[k + 1], 12, 0xE8C7B756);
                c = ff(c, d, a, b, x[k + 2], 17, 0x242070DB);
                b = ff(b, c, d, a, x[k + 3], 22, 0xC1BDCEEE);
                a = ff(a, b, c, d, x[k + 4], 7, 0xF57C0FAF);
                d = ff(d, a, b, c, x[k + 5], 12, 0x4787C62A);
                c = ff(c, d, a, b, x[k + 6], 17, 0xA8304613);
                b = ff(b, c, d, a, x[k + 7], 22, 0xFD469501);
                a = ff(a, b, c, d, x[k + 8], 7, 0x698098D8);
                d = ff(d, a, b, c, x[k + 9], 12, 0x8B44F7AF);
                c = ff(c, d, a, b, x[k + 10], 17, 0xFFFF5BB1);
                b = ff(b, c, d, a, x[k + 11], 22, 0x895CD7BE);
                a = ff(a, b, c, d, x[k + 12], 7, 0x6B901122);
                d = ff(d, a, b, c, x[k + 13], 12, 0xFD987193);
                c = ff(c, d, a, b, x[k + 14], 17, 0xA679438E);
                b = ff(b, c, d, a, x[k + 15], 22, 0x49B40821);
                
                a = gg(a, b, c, d, x[k + 1], 5, 0xF61E2562);
                d = gg(d, a, b, c, x[k + 6], 9, 0xC040B340);
                c = gg(c, d, a, b, x[k + 11], 14, 0x265E5A51);
                b = gg(b, c, d, a, x[k], 20, 0xE9B6C7AA);
                a = gg(a, b, c, d, x[k + 5], 5, 0xD62F105D);
                d = gg(d, a, b, c, x[k + 10], 9, 0x02441453);
                c = gg(c, d, a, b, x[k + 15], 14, 0xD8A1E681);
                b = gg(b, c, d, a, x[k + 4], 20, 0xE7D3FBC8);
                a = gg(a, b, c, d, x[k + 9], 5, 0x21E1CDE6);
                d = gg(d, a, b, c, x[k + 14], 9, 0xC33707D6);
                c = gg(c, d, a, b, x[k + 3], 14, 0xF4D50D87);
                b = gg(b, c, d, a, x[k + 8], 20, 0x455A14ED);
                a = gg(a, b, c, d, x[k + 13], 5, 0xA9E3E905);
                d = gg(d, a, b, c, x[k + 2], 9, 0xFCEFA3F8);
                c = gg(c, d, a, b, x[k + 7], 14, 0x676F02D9);
                b = gg(b, c, d, a, x[k + 12], 20, 0x8D2A4C8A);
                
                a = hh(a, b, c, d, x[k + 5], 4, 0xFFFA3942);
                d = hh(d, a, b, c, x[k + 8], 11, 0x8771F681);
                c = hh(c, d, a, b, x[k + 11], 16, 0x6D9D6122);
                b = hh(b, c, d, a, x[k + 14], 23, 0xFDE5380C);
                a = hh(a, b, c, d, x[k + 1], 4, 0xA4BEEA44);
                d = hh(d, a, b, c, x[k + 4], 11, 0x4BDECFA9);
                c = hh(c, d, a, b, x[k + 7], 16, 0xF6BB4B60);
                b = hh(b, c, d, a, x[k + 10], 23, 0xBEBFBC70);
                a = hh(a, b, c, d, x[k + 13], 4, 0x289B7EC6);
                d = hh(d, a, b, c, x[k], 11, 0xEAA127FA);
                c = hh(c, d, a, b, x[k + 3], 16, 0xD4EF3085);
                b = hh(b, c, d, a, x[k + 6], 23, 0x04881D05);
                a = hh(a, b, c, d, x[k + 9], 4, 0xD9D4D039);
                d = hh(d, a, b, c, x[k + 12], 11, 0xE6DB99E5);
                c = hh(c, d, a, b, x[k + 15], 16, 0x1FA27CF8);
                b = hh(b, c, d, a, x[k + 2], 23, 0xC4AC5665);
                
                a = ii(a, b, c, d, x[k], 6, 0xF4292244);
                d = ii(d, a, b, c, x[k + 7], 10, 0x432AFF97);
                c = ii(c, d, a, b, x[k + 14], 15, 0xAB9423A7);
                b = ii(b, c, d, a, x[k + 5], 21, 0xFC93A039);
                a = ii(a, b, c, d, x[k + 12], 6, 0x655B59C3);
                d = ii(d, a, b, c, x[k + 3], 10, 0x8F0CCC92);
                c = ii(c, d, a, b, x[k + 10], 15, 0xFFEFF47D);
                b = ii(b, c, d, a, x[k + 1], 21, 0x85845DD1);
                a = ii(a, b, c, d, x[k + 8], 6, 0x6FA87E4F);
                d = ii(d, a, b, c, x[k + 15], 10, 0xFE2CE6E0);
                c = ii(c, d, a, b, x[k + 6], 15, 0xA3014314);
                b = ii(b, c, d, a, x[k + 13], 21, 0x4E0811A1);
                a = ii(a, b, c, d, x[k + 4], 6, 0xF7537E82);
                d = ii(d, a, b, c, x[k + 11], 10, 0xBD3AF235);
                c = ii(c, d, a, b, x[k + 2], 15, 0x2AD7D2BB);
                b = ii(b, c, d, a, x[k + 9], 21, 0xEB86D391);
                
                a = addUnsigned(a, AA);
                b = addUnsigned(b, BB);
                c = addUnsigned(c, CC);
                d = addUnsigned(d, DD);
            }
            
            return wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d);
        }

        function generateSalt() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            const second = String(now.getSeconds()).padStart(2, '0');
            const millisecond = String(now.getMilliseconds()).padStart(3, '0').substring(0, 2);
            
            return `${year}_${month}_${day}_${hour}_${minute}_${second}_${millisecond}`;
        }

        function updateSalt() {
            currentSalt = generateSalt();
            document.getElementById('saltDisplay').textContent = currentSalt;
            updateCurrentAuditInfo();
        }

        function updateSaltOnAction() {
            updateSalt();
        }

        function updateEntriesFromText() {
            const text = document.getElementById('entriesText').value;
            entries = text.split('\n')
                .map(entry => entry.trim())
                .filter(entry => entry.length > 0);
            drawWheel();
            updateCurrentAuditInfo();
        }

        function updateTextFromEntries() {
            document.getElementById('entriesText').value = entries.join('\n');
        }

        function getActiveEntries() {
            return entries.filter(entry => !removedEntries.has(entry));
        }

        function removeDuplicates() {
            updateSaltOnAction();
            // Clear removed entries so they can be readded
            removedEntries.clear();
            const seen = new Set();
            entries = entries.filter(entry => {
                if (seen.has(entry.toLowerCase())) {
                    return false;
                }
                seen.add(entry.toLowerCase());
                return true;
            });
            updateTextFromEntries();
            drawWheel();
            updateCurrentAuditInfo();
        }

        function sortEntries() {
            updateSaltOnAction();
            // Clear removed entries so they can be readded
            removedEntries.clear();
            entries.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
            updateTextFromEntries();
            drawWheel();
            updateCurrentAuditInfo();
        }

        function randomizeEntries() {
            updateSaltOnAction();
            // Clear removed entries so they can be readded
            removedEntries.clear();
            for (let i = entries.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [entries[i], entries[j]] = [entries[j], entries[i]];
            }
            updateTextFromEntries();
            drawWheel();
            updateCurrentAuditInfo();
        }

        function drawWheel() {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 5;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const activeEntries = getActiveEntries();

            if (activeEntries.length === 0) {
                ctx.fillStyle = '#f0f0f0';
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#666';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Add items to spin!', centerX, centerY);
                return;
            }

            const angleStep = (2 * Math.PI) / activeEntries.length;

            activeEntries.forEach((entry, index) => {
                const startAngle = index * angleStep;
                const endAngle = (index + 1) * angleStep;
                
                const bgColor = colors[index % colors.length];
                ctx.fillStyle = bgColor;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fill();

                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();

                const textAngle = startAngle + angleStep / 2;
                const textRadius = radius * 0.7;
                const textX = centerX + Math.cos(textAngle) * textRadius;
                const textY = centerY + Math.sin(textAngle) * textRadius;

                ctx.save();
                ctx.translate(textX, textY);
                ctx.rotate(textAngle);
                
                const fontSize = Math.max(8, Math.min(14, Math.min(200 / entry.length, angleStep * radius / 8)));
                ctx.font = `bold ${fontSize}px Arial`;
                
                // Use the improved text color function
                ctx.fillStyle = getTextColor(bgColor);
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Wrap text if too long
                const maxWidth = angleStep * radius * 0.8;
                const words = entry.split(' ');
                let lines = [];
                let currentLine = '';
                
                words.forEach(word => {
                    const testLine = currentLine + (currentLine ? ' ' : '') + word;
                    const testWidth = ctx.measureText(testLine).width;
                    
                    if (testWidth <= maxWidth || !currentLine) {
                        currentLine = testLine;
                    } else {
                        lines.push(currentLine);
                        currentLine = word;
                    }
                });
                
                if (currentLine) {
                    lines.push(currentLine);
                }
                
                const lineHeight = fontSize * 1.2;
                const totalHeight = lines.length * lineHeight;
                const startY = -totalHeight / 2 + lineHeight / 2;
                
                lines.forEach((line, i) => {
                    ctx.fillText(line, 0, startY + i * lineHeight);
                });
                
                ctx.restore();
            });
        }

        function findWinnerByMD5() {
            const activeEntries = getActiveEntries();
            if (activeEntries.length === 0) return null;

            let lowestHash = null;
            let winner = null;
            let winnerHash = null;
            let winnerCombined = null;

            activeEntries.forEach(entry => {
                const combined = (currentSalt + entry).toLowerCase();
                const hash = md5(combined);
                
                if (lowestHash === null || hash < lowestHash) {
                    lowestHash = hash;
                    winner = entry;
                    winnerHash = hash;
                    winnerCombined = combined;
                }
            });

            return {
                winner: winner,
                hash: winnerHash,
                combined: winnerCombined
            };
        }

        // Jackpot functions
        function hashCharToLetter(char) {
            const mapping = {
                '0': 'A', 'a': 'B',
                '1': 'B', 'b': 'C',
                '2': 'C', '3': 'C', 'c': 'D',
                '4': 'D', '5': 'D', 'd': 'E',
                '6': 'E', '7': 'E', 'e': 'F',
                '8': 'F', 'f': 'G',
                '9': 'G'
            };
            return mapping[char] || 'A';
        }

        function runJackpotSlotMachine(hash) {
            isJackpotRunning = true;
            hideElementsDuringJackpot();
            jackpotResult.textContent = `... SPINNING ...`;
            jackpotResult.className = 'jackpot-result jackpot-empty';


            
            const letter1 = hashCharToLetter(hash[0]);
            const letter2 = hashCharToLetter(hash[1]);
            const letter3 = hashCharToLetter(hash[2]);

            // Start spinning animation
            const reels = ['reel1', 'reel2', 'reel3'];
            reels.forEach(reelId => {
                document.getElementById(reelId).classList.add('spinning');
            });

            // Set final letters after animation
            setTimeout(() => {
                // Update letter content and color classes
                const letter1Element = document.getElementById('letter1');
                const letter2Element = document.getElementById('letter2');
                const letter3Element = document.getElementById('letter3');
                
                // Remove old color classes
                letter1Element.className = 'slot-letter letter-' + letter1;
                letter2Element.className = 'slot-letter letter-' + letter2;
                letter3Element.className = 'slot-letter letter-' + letter3;
                
                // Set new letters
                letter1Element.textContent = letter1;
                letter2Element.textContent = letter2;
                letter3Element.textContent = letter3;

                // Remove spinning animation
                reels.forEach(reelId => {
                    document.getElementById(reelId).classList.remove('spinning');
                });

                // Check if jackpot won
                const jackpotResult = document.getElementById('jackpotResult');
                if (letter1 === letter2 && letter2 === letter3) {
                    jackpotResult.textContent = `ðŸŽ‰ JACKPOT! Triple ${letter1}'s! You won a bonus jackpot! ðŸŽ‰`;
                    jackpotResult.className = 'jackpot-result jackpot-win';
                } else {
                    jackpotResult.textContent = `${letter1} - ${letter2} - ${letter3} | No jackpot this time, but you still won the main prize!`;
                    jackpotResult.className = 'jackpot-result jackpot-lose';

                }

                // Jackpot is finished, show elements again
                isJackpotRunning = false;
                showElementsAfterJackpot();
            }, 2000);
        }

		function getCanvasRotationInDegrees(canvasId) {
			const canvas = document.getElementById(canvasId);
			if (!canvas) {
				console.error("Canvas element not found.");
				return null;
			}
			const ctx = canvas.getContext('2d');
			const transformMatrix = ctx.getTransform();
			const radians = Math.atan2(transformMatrix.b, transformMatrix.a);
			let degrees = radians * (180 / Math.PI);

			// Adjust degrees to be within 0-360 range if desired
			if (degrees < 0) {
				degrees += 360;
			}
			return degrees;
		}

        function calculateWinnerPosition(winner) {
            const activeEntries = getActiveEntries();
            const winnerIndex = activeEntries.indexOf(winner);
            if (winnerIndex === -1) return 0;
            
            const anglePerEntry = 360 / activeEntries.length;
            const centerOfSlice = (winnerIndex * anglePerEntry) + (anglePerEntry / 2);
            
            // Calculate rotation needed to align winner slice center with pointer (at top, 0Â°)
            // Since we want the center of the winner's slice to align with the pointer at top
            const targetRotation = 270 - centerOfSlice;
            
            return targetRotation % 360;
        }

        function spinWheel() {
            if (isSpinning || entries.length === 0) return;

            updateEntriesFromText();
            updateSaltOnAction(); // Generate new salt for this spin
            
            const activeEntries = getActiveEntries();
            if (activeEntries.length === 0) {
                alert('No eligible entries to spin! All items have been removed.');
                return;
            }

            // Find the winner using MD5
            const winnerData = findWinnerByMD5();
            if (!winnerData) {
                alert('Error determining winner.');
                return;
            }

            // Hide elements during spin
            hideElementsDuringSpin();

            isSpinning = true;
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.textContent = 'Spinning...';
            spinBtn.classList.add('spinning');
            spinBtn.disabled = true;

            const canvas = document.getElementById('wheelCanvas');
            
            // Calculate target rotation to land on the MD5 winner
            const targetRotation = calculateWinnerPosition(winnerData.winner);
			
			divspin = document.getElementById('divspin').innerHTML;
			divspinInt = parseInt(divspin) * (-1) ; // (parseInt(divspin / 360)) ; // * 360			
			
            const spins =  Math.floor(Math.random() * 0 + 5 ) + divspinInt; // 5-10 full rotations 5 + divspinInt ; //  
			
            const finalRotation = (spins * 360) + targetRotation // + divspinInt; // + currentRotation;
			
			document.getElementById('divspin').innerHTML = spins;
			
            canvas.style.transform = `rotate(${finalRotation}deg)`;
            canvas.style.transition = 'transform 4s cubic-bezier(0.23, 1, 0.32, 1)';
            
            setTimeout(() => {
                currentRotation = finalRotation % 360;
                showWinner(winnerData.winner, winnerData.hash, winnerData.combined);
                
                isSpinning = false;
                spinBtn.textContent = 'ðŸŽ° SPIN THE WHEEL! ðŸŽ°';
                spinBtn.classList.remove('spinning');
                spinBtn.disabled = false;
                canvas.style.transition = '';
            }, 4000);
        }

        function showWinner(winner, hash, combined) {
            document.getElementById('winnerName').textContent = winner;
            document.getElementById('winnerHash').textContent = hash;
            document.getElementById('winnerCombined').textContent = combined;
            document.getElementById('removeWinner').checked = false;
            document.getElementById('winnerModal').style.display = 'block';
            
            // Run the jackpot slot machine
            runJackpotSlotMachine(hash);
            
            createFireworks();
        }

        function closeWinnerModal() {
            const modal = document.getElementById('winnerModal');
            const winner = document.getElementById('winnerName').textContent;
            const removeWinner = document.getElementById('removeWinner').checked;
            
            if (removeWinner && winner !== 'No winner') {
                removedEntries.add(winner);
                drawWheel(); // Redraw wheel without the removed entry
            }
            
            modal.style.display = 'none';
            document.getElementById('fireworks').innerHTML = '';
	    hideElementsDuringJackpot();
            // Show elements again after closing the modal
            showElementsAfterSpin();
        }

        function createFireworks() {
            const fireworksContainer = document.getElementById('fireworks');
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.animationDelay = Math.random() * 0.5 + 's';
                    fireworksContainer.appendChild(firework);
                    
                    setTimeout(() => firework.remove(), 1500);
                }, i * 100);
            }
        }

        document.getElementById('entriesText').addEventListener('input', function() {
            setTimeout(updateEntriesFromText, 300);
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateSalt();
            updateTextFromEntries();
            drawWheel();
        });
    </script>
       
</body>
</html>